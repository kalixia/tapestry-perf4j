<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia at Mar 28, 2011 -->
<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <title>tapestry-perf4j - Perf4J Setup</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
        <meta name="author" content="Jerome Bernard" />
        <meta name="Date-Revision-yyyymmdd" content="20110328" />
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
      </head>
  <body class="composite">
    <div id="banner">
                  <span id="bannerLeft">
                tapestry-perf4j
                </span>
                    <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
            
                      <div class="xleft">
        Last Published: 2011-03-28
                      </div>
            <div class="xright">        
            </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
             
                                      <h5>Main</h5>
                  <ul>
                  <li class="none">
                  <a href="./index.html">Welcome</a>
            </li>
                  <li class="none">
                  <a href="./setup.html">Setup</a>
            </li>
                  <li class="none">
                  <a href="./perf4j-setup.html">Perf4J Setup</a>
            </li>
          </ul>
                       <h5>Profiling</h5>
                  <ul>
                  <li class="none">
                  <a href="./profiling-pages.html">Pages</a>
            </li>
                  <li class="none">
                  <a href="./profiling-services.html">Services</a>
            </li>
          </ul>
                       <h5>Displaying Graphs</h5>
                  <ul>
                  <li class="none">
                  <a href="./graphs-basic-usage.html">Basic Usage</a>
            </li>
          </ul>
                       <h5>Project Documentation</h5>
                  <ul>
                                                                                                                                                                                                                                                        <li class="collapsed">
                  <a href="project-info.html">Project Information</a>
                  </li>
                                                                                                                                                                                                  <li class="collapsed">
                  <a href="project-reports.html">Project Reports</a>
                  </li>
          </ul>
                                 <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
          <img alt="Built by Maven" src="./images/logos/maven-feather.png"/>
        </a>
                       
                  </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
        <div class="section"><h2>Perf4J Setup<a name="Perf4J_Setup"></a></h2><ul><li><a href="#Perf4J_Setup">Perf4J Setup</a><ul><li><a href="#CoalescingStatistics_Appender">CoalescingStatistics Appender</a></li><li><a href="#File_Appender">File Appender</a></li><li><a href="#Graph_Appenders">Graph Appenders</a></li><li><a href="#Perf4J_Logger">Perf4J Logger</a></li></ul></li></ul><p>This page is not meant to be a replacement to the official <a class="externalLink" href="http://perf4j.codehaus.org/">Perf4J</a> documentation.</p><p>This documentation describes how to setup Perf4J through Log4J.</p><div class="section"><h3>CoalescingStatistics Appender<a name="CoalescingStatistics_Appender"></a></h3><p>The <tt>CoalescingStatistics</tt> appender is meant to asynchronously group watches by tag. You usually define it with one <tt>appender-ref</tt> per graph you want to generate and eventually one for file storage and another one for JMX exposure of the watches.</p><p>Here is a <i>complete</i> version for 2 graphs and the file and JMX appenders:</p><style type="text/css">
    @import url('css/shCoreDefault.css');

.syntaxhighlighter {
  overflow: visible !important;
  overflow-y: hidden !important;
  overflow-x: auto !important;
}

div.syntaxhighlighter {
  border: 1px solid #e5e5e5;
}
</style>
<div id="highlighter_73541" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number17 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">appender</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"CoalescingStatistics"</code> <code class="xml color1">class</code><code class="xml plain">=</code><code class="xml string">"org.perf4j.log4j.AsyncCoalescingStatisticsAppender"</code><code class="xml plain">></code></div><div class="line number18 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!--</code></div><div class="line number19 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">The TimeSlice option is used to determine the time window for which</code></div><div class="line number20 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">all received StopWatch logs are aggregated to create a single</code></div><div class="line number21 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">GroupedTimingStatistics log. Here we set it to 10 seconds, overriding</code></div><div class="line number22 index5 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">the default of 30000 ms</code></div><div class="line number23 index6 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">--></code></div><div class="line number24 index7 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!--&lt;param name="TimeSlice" value="10000"/>--></code></div><div class="line number25 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">appender-ref</code> <code class="xml color1">ref</code><code class="xml plain">=</code><code class="xml string">"fileAppender"</code><code class="xml plain">/></code></div><div class="line number26 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">appender-ref</code> <code class="xml color1">ref</code><code class="xml plain">=</code><code class="xml string">"graphExecutionTimes"</code><code class="xml plain">/></code></div><div class="line number27 index10 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">appender-ref</code> <code class="xml color1">ref</code><code class="xml plain">=</code><code class="xml string">"graphExecutionTPS"</code><code class="xml plain">/></code></div><div class="line number28 index11 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">appender-ref</code> <code class="xml color1">ref</code><code class="xml plain">=</code><code class="xml string">"perf4jJmxAppender"</code><code class="xml plain">/></code></div><div class="line number29 index12 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">appender</code><code class="xml plain">></code></div></div></td></tr></tbody></table></div></div><div class="section"><h3>File Appender<a name="File_Appender"></a></h3><div id="highlighter_429840" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number34 index0 alt1"><code class="xml plain">&lt;</code><code class="xml keyword">appender</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"fileAppender"</code> <code class="xml color1">class</code><code class="xml plain">=</code><code class="xml string">"org.apache.log4j.FileAppender"</code><code class="xml plain">></code></div><div class="line number35 index1 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">param</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"File"</code> <code class="xml color1">value</code><code class="xml plain">=</code><code class="xml string">"perfStats.log"</code><code class="xml plain">/></code></div><div class="line number36 index2 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">layout</code> <code class="xml color1">class</code><code class="xml plain">=</code><code class="xml string">"org.apache.log4j.PatternLayout"</code><code class="xml plain">></code></div><div class="line number37 index3 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">param</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"ConversionPattern"</code> <code class="xml color1">value</code><code class="xml plain">=</code><code class="xml string">"%m%n"</code><code class="xml plain">/></code></div><div class="line number38 index4 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;/</code><code class="xml keyword">layout</code><code class="xml plain">></code></div><div class="line number39 index5 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">appender</code><code class="xml plain">></code></div></div></td></tr></tbody></table></div><p>This appender will generate a file named <tt>perfStats.log</tt> having grouped (by tag) performance metrics every 30 seconds (as defined in the <tt>CoalescingStatistics</tt> appender.</p></div><div class="section"><h3>Graph Appenders<a name="Graph_Appenders"></a></h3><div id="highlighter_136595" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number43 index0 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">appender</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"graphExecutionTimes"</code> <code class="xml color1">class</code><code class="xml plain">=</code><code class="xml string">"org.perf4j.log4j.GraphingStatisticsAppender"</code><code class="xml plain">></code></div><div class="line number44 index1 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- Possible GraphTypes are Mean, Min, Max, StdDev, Count and TPS --></code></div><div class="line number45 index2 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">param</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"GraphType"</code> <code class="xml color1">value</code><code class="xml plain">=</code><code class="xml string">"Mean"</code><code class="xml plain">/></code></div><div class="line number46 index3 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!-- The tags of the timed execution blocks to graph are specified here --></code></div><div class="line number47 index4 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!--&lt;param name="TagNamesToGraph" value="tag1,tag2,tag3"/>--></code></div><div class="line number48 index5 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">appender</code><code class="xml plain">></code></div><div class="line number49 index6 alt2">&nbsp;</div><div class="line number50 index7 alt1"><code class="xml plain">&lt;</code><code class="xml keyword">appender</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"graphExecutionTPS"</code> <code class="xml color1">class</code><code class="xml plain">=</code><code class="xml string">"org.perf4j.log4j.GraphingStatisticsAppender"</code><code class="xml plain">></code></div><div class="line number51 index8 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">param</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"GraphType"</code> <code class="xml color1">value</code><code class="xml plain">=</code><code class="xml string">"TPS"</code><code class="xml plain">/></code></div><div class="line number52 index9 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml comments">&lt;!--&lt;param name="TagNamesToGraph" value="tag1,tag2,tag3"/>--></code></div><div class="line number53 index10 alt2"><code class="xml plain">&lt;/</code><code class="xml keyword">appender</code><code class="xml plain">></code></div></div></td></tr></tbody></table></div><p>Those appenders will collect data in 2 different graphs: <tt>graphExecutionTimes</tt> and <tt>graphExecutionTPS</tt> whose definitions are quite self explanatory.</p></div><div class="section"><h3>Perf4J Logger<a name="Perf4J_Logger"></a></h3><p>Finally a logger needs to be defined:</p><div id="highlighter_515899" class="syntaxhighlighter nogutter  xml"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="code"><div class="container"><div class="line number80 index0 alt1"><code class="xml comments">&lt;!--</code></div><div class="line number81 index1 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml comments">The Perf4J logger. Note that org.perf4j.TimingLogger is the value of the</code></div><div class="line number82 index2 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml comments">org.perf4j.StopWatch.DEFAULT_LOGGER_NAME constant. Also, note that</code></div><div class="line number83 index3 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml comments">additivity is set to false, which is usually what is desired - this means</code></div><div class="line number84 index4 alt1"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml comments">that timing statements will only be sent to this logger and NOT to</code></div><div class="line number85 index5 alt2"><code class="xml spaces">&nbsp;&nbsp;</code><code class="xml comments">upstream loggers.</code></div><div class="line number86 index6 alt1"><code class="xml comments">--></code></div><div class="line number87 index7 alt2"><code class="xml plain">&lt;</code><code class="xml keyword">logger</code> <code class="xml color1">name</code><code class="xml plain">=</code><code class="xml string">"org.perf4j.TimingLogger"</code> <code class="xml color1">additivity</code><code class="xml plain">=</code><code class="xml string">"false"</code><code class="xml plain">></code></div><div class="line number88 index8 alt1"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">level</code> <code class="xml color1">value</code><code class="xml plain">=</code><code class="xml string">"INFO"</code><code class="xml plain">/></code></div><div class="line number89 index9 alt2"><code class="xml spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="xml plain">&lt;</code><code class="xml keyword">appender-ref</code> <code class="xml color1">ref</code><code class="xml plain">=</code><code class="xml string">"CoalescingStatistics"</code><code class="xml plain">/></code></div><div class="line number90 index10 alt1"><code class="xml plain">&lt;/</code><code class="xml keyword">logger</code><code class="xml plain">></code></div></div></td></tr></tbody></table></div></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        &#169;            2011
              Kalixia, SARL.
            
             - <a href="http://maven.apache.org/privacy-policy.html">Privacy Policy</a>.
        Apache Maven, Maven, Apache, the Apache feather logo, and the Apache Maven project logos are trademarks of The Apache Software Foundation.
      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>
